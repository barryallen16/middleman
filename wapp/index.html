<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MGR GPA Calculator</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="shortcut icon"
      href="./favicon/favicon.ico"
      type="image/x-icon"
    />
    <link rel="manifest" href="./favicon//site.webmanifest" />
    <link
      href="https://fonts.googleapis.com/css2?family=Sedgwick+Ave+Display&display=swap"
      rel="stylesheet"
    />
    <script src="./test.js" defer></script>
    <style>
      .font-op {
        font-family: "Sedgwick Ave Display", cursive;
        font-weight: 400;
        font-style: normal;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body class="font-mono bg-[#0e0e0e]">
    <div
      class="bg-[#0e0e0e] h-dvh w-full text-white flex flex-col justify-center items-center gap-4 px-4"
    >
      <img src="./middleman.svg" class="w-36 mt-8" />
      <div
        class="mx-auto flex gap-2 justify-center items-center px-4 py-2 bg-yellow-400/10 rounded-full text-white/60 text-wrap"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-4 w-4 md:h-6 md:w-6"
          viewBox="0 0 24 24"
        >
          <path
            fill="currentColor"
            d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10"
            opacity="0.5"
          />
          <path
            fill="currentColor"
            d="M12 17.75a.75.75 0 0 0 .75-.75v-6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75M12 7a1 1 0 1 1 0 2a1 1 0 0 1 0-2"
          />
        </svg>
        <p class="hidden md:flex">
          This calculator only works for 22-26 batch DS & AI students of
          Dr.M.G.R. University for now
        </p>
      </div>
      <div
        class="h-24 w-48 bg-white rounded-lg hidden -rotate-4 mt-8"
        id="nameTag"
      >
        <div
          class="w-[95%] h-[90%] bg-yellow-400 left-0 right-0 absolute m-auto bottom-1 rounded-lg items-center"
        >
          <h1
            class="flex justify-center items-center font-sans font-black uppercase"
          >
            Hello
          </h1>
        </div>
        <label
          class="absolute left-0 right-0 m-auto bg-white h-[60%] w-[90%] bottom-2 rounded-b-lg"
        >
          <h3
            class="uppercase text-red-600 font-op flex h-full justify-center items-center text-xl"
          >
            Jayadithya
          </h3>
        </label>
      </div>
      <div
        id="dropzone"
        class="bg-[#202020] w-[90%] h-1/2 rounded-lg flex flex-col justify-center items-center text-center cursor-pointer"
      >
        <div
          id="upload-text"
          class="flex flex-col justify-center items-center text-center p-4"
        >
          <h3>Upload your results screenshot to calculate your gpa</h3>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
          >
            <path
              fill="currentColor"
              fill-rule="evenodd"
              d="M12 15.75a.75.75 0 0 0 .75-.75V4.027l1.68 1.961a.75.75 0 1 0 1.14-.976l-3-3.5a.75.75 0 0 0-1.14 0l-3 3.5a.75.75 0 1 0 1.14.976l1.68-1.96V15c0 .414.336.75.75.75"
              clip-rule="evenodd"
            />
            <path
              fill="currentColor"
              d="M16 9c-.702 0-1.053 0-1.306.169a1 1 0 0 0-.275.275c-.169.253-.169.604-.169 1.306V15a2.25 2.25 0 1 1-4.5 0v-4.25c0-.702 0-1.053-.169-1.306a1 1 0 0 0-.275-.275C9.053 9 8.702 9 8 9c-2.828 0-4.243 0-5.121.879C2 10.757 2 12.17 2 14.999v1c0 2.83 0 4.243.879 5.122C3.757 22 5.172 22 8 22h8c2.828 0 4.243 0 5.121-.879S22 18.828 22 16v-1c0-2.829 0-4.243-.879-5.121C20.243 9 18.828 9 16 9"
            />
          </svg>
        </div>
        <ul id="preview" class="hidden list-none"></ul>
        <input type="file" id="file-input" accept="image/*" class="hidden" />
      </div>
      <div class="flex gap-4">
        <button
          id="cal-btn"
          disabled
          type="button"
          class="p-4 bg-white rounded-full flex gap-2 text-black cursor-pointer disabled:cursor-not-allowed disabled:bg-white/20"
        >
          calculate gpa
        </button>
        <button
          id="clear-btn"
          type="button"
          disabled
          class="p-4 bg-[#202020] rounded-full flex gap-2 cursor-pointer disabled:cursor-not-allowed"
        >
          clear
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
          >
            <path
              fill="currentColor"
              d="M22 12.698c-.002 1.47-.013 2.718-.096 3.743c-.097 1.19-.296 2.184-.74 3.009a4.2 4.2 0 0 1-.73.983c-.833.833-1.893 1.21-3.237 1.39C15.884 22 14.2 22 12.053 22h-.106c-2.148 0-3.83 0-5.144-.177c-1.343-.18-2.404-.557-3.236-1.39c-.738-.738-1.12-1.656-1.322-2.795c-.2-1.12-.236-2.512-.243-4.241Q1.999 12.737 2 12v-.054c0-2.148 0-3.83.177-5.144c.18-1.343.557-2.404 1.39-3.236s1.893-1.21 3.236-1.39c1.168-.157 2.67-.175 4.499-.177a.697.697 0 1 1 0 1.396c-1.855.002-3.234.018-4.313.163c-1.189.16-1.906.464-2.436.994S3.72 5.8 3.56 6.99C3.397 8.2 3.395 9.788 3.395 12v.784l.932-.814a2.14 2.14 0 0 1 2.922.097l3.99 3.99a1.86 1.86 0 0 0 2.385.207l.278-.195a2.79 2.79 0 0 1 3.471.209l2.633 2.37c.265-.557.423-1.288.507-2.32c.079-.972.09-2.152.091-3.63a.698.698 0 0 1 1.396 0"
            />
            <path
              fill="currentColor"
              fill-rule="evenodd"
              d="M17.5 11c-2.121 0-3.182 0-3.841-.659S13 8.621 13 6.5s0-3.182.659-3.841S15.379 2 17.5 2s3.182 0 3.841.659S22 4.379 22 6.5s0 3.182-.659 3.841S19.621 11 17.5 11m-1.47-7.03a.75.75 0 1 0-1.06 1.06l1.47 1.47l-1.47 1.47a.75.75 0 0 0 1.06 1.06l1.47-1.47l1.47 1.47a.75.75 0 1 0 1.06-1.06L18.56 6.5l1.47-1.47a.75.75 0 0 0-1.06-1.06L17.5 5.44z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
      </div>
    </div>
    <div class="h-full py-8 bg-pink-500 text-white">
      <div class="flex justify-center items-center">
        <div
          class="h-24 w-48 bg-white rounded-lg pt-8 relative -rotate-4"
          id="nameTagContainer"
        >
          <div
            class="w-[95%] h-[90%] bg-yellow-400 left-0 right-0 absolute m-auto bottom-1 rounded-lg items-center"
          >
            <h1
              class="flex justify-center items-center font-sans font-black uppercase"
            >
              Hello
            </h1>
          </div>
          <label
            class="absolute left-0 right-0 m-auto bg-white h-[60%] w-[90%] bottom-2 rounded-b-lg"
          >
            <div
              class="uppercase text-red-600 font-op flex flex-col h-full justify-center items-center text-xl"
            >
              <h3 id="stdname"></h3>
              <h3 class="text-sm" id="stdregno"></h3>
            </div>
          </label>
        </div>
      </div>
      <ul
        class="list-none flex flex-col justify-center items-center pt-8 gap-4"
        id="resultDisplay"
      ></ul>
    </div>
    <script>
      const dropZone = document.getElementById("dropzone");
      const preview = document.getElementById("preview");
      const fileInput = document.getElementById("file-input");
      const clrbtn = document.getElementById("clear-btn");
      const uploadText = document.getElementById("upload-text");
      const calbtn = document.getElementById("cal-btn");
      const apiUploadenpoint = "http://localhost:8000/uploadfile/";
      calbtn.addEventListener("click", function (e) {
        sendImage(e);
      });
      async function sendImage(e) {
        e.preventDefault();
        const formData = new FormData();
        formData.append("file", fileInput.files[0]);
        const response = await fetch(apiUploadenpoint, {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => console.log(data))
          .catch((error) => console.error("Error:", error));
      }
      clrbtn.addEventListener("click", () => {
        fileInput.file = "";
        for (const img of preview.querySelectorAll("img")) {
          URL.revokeObjectURL(img.src);
          preview.removeChild(img);
          removeImage();
        }
      });
      fileInput.addEventListener("change", (e) => {
        displayImage(e.target.files);
      });
      function addImage() {
        uploadText.classList.remove("flex");
        uploadText.classList.add("hidden");
        preview.classList.remove("hidden");
        preview.classList.add("flex");
        clrbtn.removeAttribute("disabled");
        calbtn.removeAttribute("disabled");
      }
      function removeImage() {
        uploadText.classList.remove("hidden");
        uploadText.classList.add("flex");
        preview.classList.remove("flex");
        preview.classList.add("hidden");
        clrbtn.classList.remove("cursor-pointer");
        calbtn.setAttribute("disabled", true);
        clrbtn.removeAttribute("disabled");
      }
      function displayImage(files) {
        for (const file of files) {
          if (file.type.startsWith("image/")) {
            const img = document.createElement("img");
            img.src = URL.createObjectURL(file);
            img.classList.add("object-cover");
            addImage();
            preview.appendChild(img);
          }
        }
      }
      function dropHandler(ev) {
        ev.preventDefault();
        const files = [...ev.dataTransfer.items]
          .map((item) => item.getAsFile())
          .filter((file) => file);
        displayImage(files);
      }
      dropZone.addEventListener("drop", dropHandler);
      window.addEventListener("drop", (e) => {
        if ([...e.dataTransfer.files].some((item) => item.kind === "file")) {
          e.preventDefault();
        }
      });
      dropZone.addEventListener("dragover", (e) => {
        const fileItems = [...e.dataTransfer.files].filter(
          (item) => item.kind == "file"
        );
        if (fileItems.length > 0) {
          e.preventDefault();
          if (fileItems.some((item) => item.type.startsWith("image/"))) {
            e.dataTransfer.dropEffect("copy");
          } else {
            e.dataTransfer.dropEffect("none");
          }
        }
      });
      window.addEventListener("dragover", (e) => {
        const fileItems = [...e.dataTransfer.files].filter((item) =>
          item.type.startsWith("image/")
        );
        if (fileItems.length > 0) {
          e.preventDefault();
          if (!dropZone.contains(e.target)) {
            e.dataTransfer.dropEffect("none");
          }
        }
      });
    </script>
  </body>
</html>
